<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Praise FM - En Direct</title>
  <link rel="icon" type="image/png" sizes="32x32" href="/image/favicon-32x32.png">
  <style>
    :root { --orange: #ff4d00; --dark: #111; --bg: #fff; }
    * { margin:0; padding:0; box-sizing:border-box; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif; }
    body { background: var(--bg); color: #000; min-height:100vh; display:flex; flex-direction:column; align-items:center; padding-top:60px; }
    
    .top-bar {
      position:fixed; top:0; left:0; right:0; background:#111; color:#fff; padding:12px 20px;
      display:flex; justify-content:space-between; align-items:center; font-size:14px; z-index:999;
      box-shadow:0 2px 8px rgba(0,0,0,0.2);
    }
    .top-bar .message { flex:1; line-height:1.4; margin-right:16px; }
    .top-bar .region-buttons { display:flex; gap:8px; flex-wrap:wrap; }
    .top-bar button {
      background:#0071e3; border:none; color:white; padding:6px 12px; border-radius:20px;
      font-size:12px; cursor:pointer; white-space:nowrap;
    }
    .top-bar button.close {
      background:none; color:#aaa; font-size:18px; padding:6px; margin-left:8px;
    }

    .container {
      max-width:900px; width:100%; padding:20px; text-align:center;
    }
    .station-title {
      font-size:32px; font-weight:900; color:var(--orange); margin:20px 0 4px;
    }
    .station-subtitle {
      font-size:17px; color:#555; margin-bottom:30px;
    }
    .program-image {
      width:min(80vw,320px); height:min(80vw,320px); border-radius:50%; overflow:hidden; background:#000;
      margin:0 auto 20px; position:relative;
    }
    .program-image img {
      width:100%; height:100%; object-fit:cover;
    }
    .live-indicator {
      display:inline-flex; align-items:center; gap:8px; color:var(--orange);
      font-weight:700; font-size:14px; text-transform:uppercase; letter-spacing:1px;
      margin-bottom:12px;
    }
    .live-dot {
      width:9px; height:9px; background:var(--orange); border-radius:50%;
      animation:pulse 2s infinite;
    }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
    .program-name {
      font-size:28px; font-weight:800; margin:10px 0 30px; line-height:1.2;
    }
    .play-button {
      margin:40px auto; width:220px; height:56px; background:var(--orange); color:#fff; border:none;
      border-radius:28px; font-size:18px; font-weight:700; cursor:pointer;
      display:flex; align-items:center; justify-content:center; gap:8px;
      box-shadow:0 6px 20px rgba(255,77,0,.3); transition:transform .2s;
    }
    .play-button:hover { transform:scale(1.05); }
    .play-button svg { width:24px; height:24px; fill:#fff; }

    .upnext-section {
      background:#f8f8f8; border-radius:12px; padding:20px; margin:40px 0; text-align:left;
    }
    .upnext-items { display:flex; gap:20px; flex-wrap:wrap; }
    .upnext-item { flex:1; min-width:200px; display:flex; align-items:center; gap:16px; }
    .upnext-img { width:60px; height:60px; border-radius:0; object-fit:cover; background:#eee; }
    .upnext-time {
      font-size:14px; font-weight:700; color:var(--orange); text-transform:uppercase;
      letter-spacing:0.5px;
    }
    .upnext-title { font-size:16px; font-weight:700; margin-top:4px; }
    .upnext-desc { font-size:14px; color:#555; margin-top:4px; }

    .recently {
      margin-top:40px; text-align:left;
    }
    .recently-header {
      font-size:13px; font-weight:700; color:#555; text-transform:uppercase;
      letter-spacing:1px; margin-bottom:12px;
    }
    .recent-item {
      display:flex; align-items:center; gap:12px; padding:12px 0; border-bottom:1px solid #ddd;
    }
    .recent-cover { width:48px; height:48px; border-radius:0; object-fit:cover; background:#eee; }
    .recent-title { font-weight:600; font-size:15px; }
    .recent-artist { font-size:13px; color:#888; }

    @media (max-width:500px) {
      .top-bar { flex-direction:column; align-items:flex-start; gap:8px; }
      .top-bar .region-buttons { margin-top:8px; }
    }
  </style>
</head>
<body>

<div class="top-bar">
  <div class="message">
    <strong>Bonjour ! Vous Ãªtes en France.</strong><br>
    Voulez-vous passer Ã  une autre version rÃ©gionale ?
  </div>
  <div class="region-buttons">
    <button onclick="window.location.href='https://praisefmde.vercel.app'">ðŸ‡©ðŸ‡ª Allemagne</button>
    <button onclick="window.location.href='https://praisefmch-fr.vercel.app'">ðŸ‡¨ðŸ‡­ Suisse (FR)</button>
    <button onclick="window.location.href='https://praisefmch-de.vercel.app'">ðŸ‡¨ðŸ‡­ Suisse (DE)</button>
    <button class="close" onclick="this.parentElement.parentElement.style.display='none'">&times;</button>
  </div>
</div>

<div class="container">
  <h1 class="station-title">Praise FM</h1>
  <p class="station-subtitle">Louange & Adoration</p>

  <div class="program-image">
    <img id="mainImg" src="/image/logopraisefm.webp" alt="En cours de lecture">
  </div>

  <div class="live-indicator">
    <div class="live-dot"></div>
    EN DIRECT
  </div>

  <h2 class="program-name" id="programTitle">Praise FM</h2>

  <button class="play-button" id="bigPlay">
    <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg> Lecture
  </button>

  <div class="upnext-section">
    <div class="upnext-items">
      <div class="upnext-item">
        <img id="upnextImg1" src="/image/logopraisefm.webp" class="upnext-img">
        <div>
          <div class="upnext-time" id="upnextTime1">-</div>
          <div class="upnext-title" id="upnextTitle1">-</div>
          <div class="upnext-desc" id="upnextDesc1">-</div>
        </div>
      </div>
      <div class="upnext-item">
        <img id="upnextImg2" src="/image/logopraisefm.webp" class="upnext-img">
        <div>
          <div class="upnext-time" id="upnextTime2">-</div>
          <div class="upnext-title" id="upnextTitle2">-</div>
          <div class="upnext-desc" id="upnextDesc2">-</div>
        </div>
      </div>
    </div>
  </div>

  <div class="recently">
    <div class="recently-header">DerniÃ¨res diffusions</div>
    <div id="recentList"></div>
  </div>
</div>

<script>
  const STREAM_URL = "https://stream.zeno.fm/hvwifp8ezc6tv";
  const audio = new Audio(STREAM_URL);
  audio.volume = 0.8;
  const images = {
    default: "/image/logopraisefm.webp",
    midnight: "/image/midnightgracelogo.webp",
    worship: "/image/praisefmworship.png",
    morning: "/image/morningshowlogo.webp",
    midday: "/image/middaygracelogo.webp",
    nonstop: "/image/praisefmnonstop.png",
    carpool: "/image/praisefmcarpoollogo.webp",
    pop: "/image/praisefmpoplogo.webp",
    sunday: "/image/sundaywithchrist.png",
    magazine: "/image/praisefmmagazine.png"
  };
  const hosts = {
    "Morning Show": "Stancy Campbell",
    "Midday Grace": "Michael Ray",
    "Praise FM Carpool": "Rachael Harris",
    "Praise FM POP": "Jordan Reys",
    "Sunday With Christ": "Matt Riley",
    "Midnight Grace": "Daniel Brooks",
    "Praise FM Non Stop": "Praise FM",
    "Praise FM Worship": "Praise FM"
  };
  const schedule = [
    {start:"00:00", end:"03:00", name:"Praise FM Worship", img:images.worship, desc: "Praise FM diffuse la meilleure musique d'adoration."},
    {start:"03:00", end:"06:00", name:"Midnight Grace", img:images.midnight, desc: "Daniel Brooks vous propose une louange apaisante toute la nuit."},
    {start:"06:00", end:"07:00", name:"Praise FM Worship", img:images.worship, desc: "Praise FM diffuse la meilleure musique d'adoration."},
    {start:"07:00", end:"12:00", name:"Morning Show", img:images.morning, days:[1,2,3,4,5,6], desc: "Stancy Campbell lance votre journÃ©e avec de la louange inspirante."},
    {start:"07:00", end:"12:00", name:"Sunday With Christ", img:images.sunday, days:[0], desc: "Matt Riley partage des rÃ©flexions spirituelles et de la musique dominicale."},
    {start:"12:00", end:"16:00", name:"Midday Grace", img:images.midday, desc: "Michael Ray vous accompagne avec grÃ¢ce et musique en milieu de journÃ©e."},
    {start:"16:00", end:"17:00", name:"Praise FM Non Stop", img:images.nonstop, desc: "Praise FM en continu avec les meilleurs titres de louange."},
    {start:"17:00", end:"18:00", name:"Praise FM Worship", img:images.worship, desc: "Praise FM diffuse la meilleure musique d'adoration."},
    {start:"18:00", end:"20:00", name:"Praise FM Carpool", img:images.carpool, days:[1,2,3,4,5], desc: "Rachael Harris vous accompagne avec de la louange pour votre retour Ã  la maison."},
    {start:"20:00", end:"20:30", name:"Praise FM POP", img:images.pop, desc: "Jordan Reys prÃ©sente tout ce qui est pop et louange contemporaine."},
    {start:"20:30", end:"20:31", name:"Praise FM Magazine", img:images.magazine, days:[0], desc: "Praise FM avec du contenu sous forme de magazine et des reportages."},
    {start:"20:30", end:"21:30", name:"Praise FM Non Stop", img:images.nonstop, days:[1,2,3,4,5,6], desc: "Praise FM en continu avec les meilleurs titres de louange."},
    {start:"21:30", end:"00:00", name:"Praise FM Worship", img:images.worship, desc: "Praise FM diffuse la meilleure musique d'adoration."}
  ];

  const programNames = {
    "Midnight Grace": "GrÃ¢ce de Minuit",
    "Morning Show": "Ã‰mission du Matin",
    "Midday Grace": "GrÃ¢ce de Midi",
    "Praise FM Non Stop": "Praise FM Sans ArrÃªt",
    "Praise FM Worship": "Praise FM Adoration",
    "Praise FM Carpool": "Praise FM Covoiturage",
    "Praise FM POP": "Praise FM POP",
    "Sunday With Christ": "Dimanche avec Christ",
    "Praise FM Magazine": "Praise FM Magazine"
  };

  function getTime() { return new Date(new Date().toLocaleString("en-US",{timeZone:"America/Chicago"})); }
  function timeToMins(t) { const [h,m]=t.split(":").map(Number); return h*60+m; }
  function getCurrentAndNext() {
    const now = getTime();
    const day = now.getDay();
    const mins = timeToMins(now.toTimeString().slice(0,5));
    let current = null;
    const future = [];
    for (const p of schedule) {
      if (p.days && !p.days.includes(day)) continue;
      const s = timeToMins(p.start);
      const e = timeToMins(p.end);
      const end = e <= s ? e + 1440 : e;
      if (mins >= s && mins < end) {
        if (!current || end > timeToMins(current.end)) current = p;
      }
      if (mins < s) future.push({prog:p, startMins:s});
    }
    if (future.length === 0) {
      const tomorrow = (day + 1) % 7;
      for (const p of schedule) {
        if (!p.days || p.days.includes(tomorrow)) future.push({prog:p, startMins:timeToMins(p.start)});
      }
    }
    future.sort((a,b) => a.startMins - b.startMins);
    return {
      current: current || {name:"Praise FM", img:images.default, start:null, end:null, desc:""},
      next1: future[0]?.prog || schedule[0],
      next2: future[1]?.prog || schedule[1]
    };
  }

  function formatProgramName(p) {
    if (!p) return "Praise FM";
    const base = p.name.replace(/ \([^)]*\)$/, '').trim();
    const translated = programNames[base] || base;
    if (["Praise FM Non Stop", "Praise FM POP", "Praise FM Magazine", "Praise FM Worship", "Praise FM"].includes(base)) {
      return translated;
    }
    const host = hosts[base] || "Praise FM";
    return `${translated} avec ${host}`;
  }

  function formatRange(p) {
    const [sh, sm] = p.start.split(":").map(Number);
    const [eh, em] = p.end.split(":").map(Number);
    const sSuffix = sh >= 12 ? "PM" : "AM";
    const eSuffix = eh >= 12 ? "PM" : "AM";
    const sHour = ((sh + 11) % 12) + 1;
    const eHour = ((eh + 11) % 12) + 1;
    return `${sHour}:${sm.toString().padStart(2,'0')} ${sSuffix} - ${eHour}:${em.toString().padStart(2,'0')} ${eSuffix}`;
  }

  function formatTime(seconds) {
    const min = Math.floor(seconds / 60);
    const sec = Math.floor(seconds % 60);
    return `${min}:${sec.toString().padStart(2, '0')}`;
  }

  let currentTrack = {title:"", artist:"", duration:0, startTime:0};
  const recents = [];

  async function fetchAlbumCover(artist, title) {
    if (!artist || !title) return images.default;
    const query = encodeURIComponent(`${artist} ${title}`);
    const url = `https://itunes.apple.com/search?term=${query}&entity=song&limit=1`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      if (data.results?.[0]?.artworkUrl100) {
        return data.results[0].artworkUrl100.replace('100x100', '600x600');
      }
    } catch (e) {}
    return images.default;
  }

  async function processMetadata(artist, title) {
    if (title.toLowerCase().includes("commercial") || title.toLowerCase().includes("ad")) {
      currentTrack = {title:"", artist:"", duration:0, startTime:0};
    } else {
      currentTrack = {title, artist, duration:0, startTime:Date.now()};
      const cover = await fetchAlbumCover(artist, title);
      const key = `${artist}-${title}`;
      if (!recents.some(t => t.key === key)) {
        recents.unshift({title, artist, cover, key});
        if (recents.length > 4) recents.pop();
        document.getElementById("recentList").innerHTML = recents.map(t => `
          <div class="recent-item">
            <img src="${t.cover}" class="recent-cover" onerror="this.src='${images.default}'">
            <div>
              <div class="recent-title">${t.title}</div>
              <div class="recent-artist">${t.artist}</div>
            </div>
          </div>
        `).join("");
      }
    }
    updateDisplay();
  }

  try {
    const es = new EventSource("https://api.zeno.fm/mounts/metadata/subscribe/hvwifp8ezc6tv");
    es.onmessage = e => {
      try {
        const d = JSON.parse(e.data);
        if (d.streamTitle) {
          const parts = d.streamTitle.split(" - ");
          processMetadata(parts[0]||"", parts.slice(1).join(" - ")||"");
        }
      } catch {}
    };
  } catch(e) {}

  function togglePlay() {
    if (audio.paused) { audio.play(); }
    else audio.pause();
    const playing = !audio.paused;
    const playSvg = '<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>';
    const pauseSvg = '<svg viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';
    document.querySelector("#bigPlay").innerHTML = playing ? pauseSvg + ' Pause' : playSvg + ' Lecture';
  }

  document.getElementById("bigPlay").onclick = togglePlay;

  function updateDisplay() {
    const {current, next1, next2} = getCurrentAndNext();
    document.getElementById("mainImg").src = current.img || images.default;
    document.getElementById("upnextImg1").src = next1.img || images.default;
    document.getElementById("upnextImg2").src = next2.img || images.default;
    document.getElementById("programTitle").textContent = formatProgramName(current);
    document.getElementById("upnextTime1").textContent = "Ã€ VENIR : " + formatRange(next1);
    document.getElementById("upnextTitle1").textContent = formatProgramName(next1);
    document.getElementById("upnextDesc1").textContent = next1.desc || "-";
    document.getElementById("upnextTime2").textContent = formatRange(next2);
    document.getElementById("upnextTitle2").textContent = formatProgramName(next2);
    document.getElementById("upnextDesc2").textContent = next2.desc || "-";
  }

  setInterval(updateDisplay, 8000);
  updateDisplay();
</script>
</body>
</html>
